DROP TABLE RESEARCH_GROUP CASCADE CONSTRAINTS;
DROP TABLE STUDENT CASCADE CONSTRAINTS;
DROP TABLE JOINING CASCADE CONSTRAINTS;
DROP TABLE CONFERENCE CASCADE CONSTRAINTS;
DROP TABLE PAPER CASCADE CONSTRAINTS;
DROP TABLE PUBLISHING CASCADE CONSTRAINTS;
DROP ROLE GROUP_HEAD_ROLE;
DROP ROLE TEAM_MEMBER_ROLE;
DROP USER GROUP_HEAD_USER CASCADE;
DROP USER TEAM_MEMBER_USER CASCADE;
DROP VIEW RESEARCH_WORK;



-- A: DDL statements for the tables

create table research_group(
    r_id NUMBER(5),
    r_name VARCHAR2(20),
    LAB VARCHAR2(20),
    BUDGET NUMBER(10,5),
    GROUP_HEAD NUMBER(5),
    MEETING_TIME VARCHAR2(20),
    CONSTRAINT research_group_pk PRIMARY KEY(r_id)
);

CREATE TABLE STUDENT(
    S_ID NUMBER(5),
    S_NAME VARCHAR2(20),
    CONTACT VARCHAR2(20),
    CONSTRAINT STUDENT_PK PRIMARY KEY(S_ID)
);

CREATE TABLE JOINING(
    S_ID NUMBER(5),
    R_ID NUMBER(5),
    JOINING_DATE DATE,
    CONSTRAINT JOINING_PK PRIMARY KEY(S_ID,R_ID),
    CONSTRAINT JOINING_FK1 FOREIGN KEY(S_ID) REFERENCES STUDENT(S_ID),
    CONSTRAINT JOINING_FK2 FOREIGN KEY(R_ID) REFERENCES RESEARCH_GROUP(R_ID)
);

CREATE TABLE CONFERENCE(
    C_ID NUMBER(5),
    C_NAME VARCHAR2(20),
    C_LOCATION VARCHAR2(20),
    C_DATE DATE,
    CONSTRAINT CONFERENCE_PK PRIMARY KEY(C_ID)
);

CREATE TABLE PAPER(
    PAPER_ID NUMBER(5),
    PAPER_TITLE VARCHAR2(20),
    CONSTRAINT PAPER_PK PRIMARY KEY(PAPER_ID)
);

CREATE TABLE PUBLISHING(
    S_ID NUMBER(5),
    C_ID NUMBER(5),
    R_ID NUMBER(5),
    PAPER_ID NUMBER(5),
    PUBLISH_DATE DATE,
    CONSTRAINT PUBLISHING_PK PRIMARY KEY(S_ID,C_ID,PAPER_ID),
    CONSTRAINT PUBLISHING_FK1 FOREIGN KEY(S_ID) REFERENCES STUDENT(S_ID),
    CONSTRAINT PUBLISHING_FK2 FOREIGN KEY(C_ID) REFERENCES CONFERENCE(C_ID),
    CONSTRAINT PUBLISHING_FK3 FOREIGN KEY(PAPER_ID) REFERENCES PAPER(PAPER_ID),
    CONSTRAINT PUBLISHING_FK4 FOREIGN KEY(R_ID) REFERENCES RESEARCH_GROUP(R_ID)
);



-- INSERTING DATA INTO THE TABLES
INSERT INTO RESEARCH_GROUP VALUES(1,'AI','A',10000,1,'10:00');
INSERT INTO RESEARCH_GROUP VALUES(2,'ML','B',20000,2,'11:00');
INSERT INTO RESEARCH_GROUP VALUES(3,'DL','C',30000,3,'12:00');
INSERT INTO RESEARCH_GROUP VALUES(4,'NLP','D',40000,4,'13:00');

INSERT INTO STUDENT VALUES(1,'A','1234567890');
INSERT INTO STUDENT VALUES(2,'B','1234567890');
INSERT INTO STUDENT VALUES(3,'C','1234567890');
INSERT INTO STUDENT VALUES(4,'D','1234567890');
INSERT INTO STUDENT VALUES(5,'E','1234567890');

INSERT INTO JOINING VALUES(1,1,'01-JAN-2020');
INSERT INTO JOINING VALUES(2,2,'01-JAN-2020');
INSERT INTO JOINING VALUES(3,3,'01-JAN-2020');
INSERT INTO JOINING VALUES(4,4,'01-JAN-2020');
INSERT INTO JOINING VALUES(5,1,'01-JAN-2020');

INSERT INTO CONFERENCE VALUES(1,'CONFERENCE1','DHAKA','01-JAN-2020');
INSERT INTO CONFERENCE VALUES(2,'CONFERENCE2','KHULNA','01-JAN-2020');
INSERT INTO CONFERENCE VALUES(3,'CONFERENCE3','RAJSHAHI','01-JAN-2020');
INSERT INTO CONFERENCE VALUES(4,'CONFERENCE4','SYLHET','01-JAN-2020');

INSERT INTO PAPER VALUES(1,'PAPER1');
INSERT INTO PAPER VALUES(2,'PAPER2');
INSERT INTO PAPER VALUES(3,'PAPER3');
INSERT INTO PAPER VALUES(4,'PAPER4');

INSERT INTO PUBLISHING VALUES(1,1,1,1,'01-JAN-2020');
INSERT INTO PUBLISHING VALUES(2,2,2,2,'01-JAN-2020');
INSERT INTO PUBLISHING VALUES(3,3,3,3,'01-JAN-2020');
INSERT INTO PUBLISHING VALUES(4,4,4,4,'01-JAN-2020');
INSERT INTO PUBLISHING VALUES(5,1,1,1,'01-JAN-2020');




-- B : ROLE AND USER CREATION
CREATE ROLE GROUP_HEAD_ROLE;
GRANT CREATE SESSION, RESOURCE, CREATE TABLESPACE TO GROUP_HEAD_ROLE;
GRANT SELECT,INSERT,UPDATE,DELETE ON RESEARCH_GROUP TO GROUP_HEAD_ROLE;
GRANT SELECT,INSERT,UPDATE,DELETE ON JOINING TO GROUP_HEAD_ROLE;
GRANT SELECT,INSERT,UPDATE,DELETE ON STUDENT TO GROUP_HEAD_ROLE;
GRANT SELECT,INSERT,UPDATE,DELETE ON CONFERENCE TO GROUP_HEAD_ROLE;
GRANT SELECT,INSERT,UPDATE,DELETE ON PUBLISHING TO GROUP_HEAD_ROLE;

CREATE ROLE TEAM_MEMBER_ROLE;
GRANT CREATE SESSION, RESOURCE, CREATE TABLESPACE TO TEAM_MEMBER_ROLE;
GRANT SELECT ON STUDENT TO TEAM_MEMBER_ROLE;
GRANT SELECT ON JOINING TO TEAM_MEMBER_ROLE;
GRANT SELECT ON RESEARCH_GROUP TO TEAM_MEMBER_ROLE;
GRANT SELECT, INSERT ON CONFERENCE TO TEAM_MEMBER_ROLE;
GRANT SELECT, INSERT ON PUBLISHING TO TEAM_MEMBER_ROLE;


-- USER CREATING
CREATE USER GROUP_HEAD_USER IDENTIFIED BY group_head_user;
GRANT GROUP_HEAD_ROLE TO GROUP_HEAD_USER;

CREATE USER TEAM_MEMBER_USER IDENTIFIED BY team_member_user;
GRANT TEAM_MEMBER_ROLE TO TEAM_MEMBER_USER;


-- C : VIEW CREATION
CREATE OR REPLACE VIEW RESEARCH_WORK AS
SELECT PAPER_ID, COUNT(R_ID) AS NO_OF_RESEARCH_GROUPS, COUNT(S_ID) AS NO_OF_STUDENTS
FROM PUBLISHING
GROUP BY PAPER_ID;


-- CHECK
SELECT * FROM RESEARCH_WORK;



